{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Buscando recomendaciones...</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'albums/css/style.css' %}">
</head>
<body>
    <div class="container">
        <div class="loading">
            <div class="loading-spinner"></div>
            <h2 class="mt-4">Buscando recomendaciones, por favor espera...</h2>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Recuperar los datos del formulario
                const formData = sessionStorage.getItem('searchFormData');
                if (!formData) {
                    window.location.href = "{% url 'buscar_album' %}";
                    return;
                }

                // Crear un formulario oculto y enviarlo
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'buscar_album' %}";
                
                // Agregar CSRF token
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = '{{ csrf_token }}';
                form.appendChild(csrfInput);

                // Agregar los datos del formulario
                const formParams = new URLSearchParams(formData);
                for (const [key, value] of formParams) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                // Limpiar sessionStorage
                sessionStorage.removeItem('searchFormData');

                // Agregar el formulario al documento y enviarlo
                document.body.appendChild(form);
                form.submit();
            } catch (error) {
                console.error('Error:', error);
                alert('Hubo un error al realizar la búsqueda. Por favor, inténtalo de nuevo.');
                window.location.href = "{% url 'buscar_album' %}";
            }
        });
    </script>
</body>
</html>
