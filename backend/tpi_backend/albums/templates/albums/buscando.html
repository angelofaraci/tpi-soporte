{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Searching for recommendations...</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'albums/css/style.css' %}">
</head>
<body>
    <div class="container">
        <div class="loading">
            <div class="loading-spinner"></div>
            <h2 class="mt-4">Searching for recommendations, please wait...</h2>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // Retrieve form data
                const formData = sessionStorage.getItem('searchFormData');
                if (!formData) {
                    window.location.href = "{% url 'buscar_album' %}";
                    return;
                }

                // Create a hidden form and submit it
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = "{% url 'buscar_album' %}";
                
                // Add CSRF token
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = '{{ csrf_token }}';
                form.appendChild(csrfInput);

                // Add form data
                const formParams = new URLSearchParams(formData);
                for (const [key, value] of formParams) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = value;
                    form.appendChild(input);
                }

                // Clear sessionStorage
                sessionStorage.removeItem('searchFormData');

                // Add the form to document and submit it
                document.body.appendChild(form);
                form.submit();
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error performing the search. Please try again.');
                window.location.href = "{% url 'buscar_album' %}";
            }
        });
    </script>
</body>
</html>
